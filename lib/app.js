'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i['return'])_i['return']()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var PORT_LISTENER=process.env.NODE_PORT||process.env.PORT||9000;console.log('I am listening to this port: http://localhost:%s',PORT_LISTENER);var express=require('express'),bodyParser=require('body-parser'),methodOverride=require('method-override'),cookieParser=require('cookie-parser'),session=require('express-session'),errorhandler=require('errorhandler'),favicon=require('serve-favicon'),logger=require('morgan'),j;http=require('http'),path=require('path'),_=require('lodash'),dotenv=require('dotenv').config({silent:true}),redis_url=process.env.REDIS_PORT||process.env.REDIS_URL||'redis://localhost:6379',redis=require('url').parse(redis_url);console.log(process.env);console.log(redis_url);var Promise=require('bluebird'),seneca=Promise.promisifyAll(require('seneca')({timeout:3000})).use('redis-queue-transport',{'redis-queue':{timeout:3000,type:'redis-queue',url:redis_url}}).client({type:'redis-queue'});var appConfig=require('./config/appConfig.json');var proxy=require('express-http-proxy');var app=express();var _ref=[process.env.COOKIE_SECRET_KEY,process.env.SESSION_SECRET_KEY],COOKIE_SECRET_KEY=_ref.COOKIE_SECRET_KEY,SESSION_SECRET_KEY=_ref.SESSION_SECRET_KEY;app.set('port',PORT_LISTENER);app.set('views',__dirname+'/views');app.use(logger('dev'));app.use(bodyParser({keepExtensions:true,uploadDir:path.join(__dirname,appConfig.directories.publicDir)}));app.use(methodOverride());app.use(cookieParser(COOKIE_SECRET_KEY));app.use(session({resave:true,saveUninitialized:true,secret:SESSION_SECRET_KEY}));var _split=(process.env.API_PORT||'tcp://localhost:3001').split(/\:/),_split2=_slicedToArray(_split,3),protocol=_split2[0],host=_split2[1],port=_split2[2];host=host.replace(/\/\//,'');console.log('Host',host,'Port',port);app.use(express.static(path.resolve(__dirname,appConfig.directories.publicDir)));app.use('/',require('./routes/index'));app.use('/api',require('./routes/proxy'));if('development'===app.get('env')){app.use(errorhandler())}http.createServer(app).listen(app.get('port'),'0.0.0.0',function(){console.log('Express server listening on port '+app.get('port'))});